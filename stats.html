<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="KakTrak">

    <title>KakTrak - Health-out your gut</title>

    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Matemasie&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <nav>
        <div class="navbar">
            <a href="index.html"><span class="icon"><ion-icon name="home-outline"></ion-icon></span></a>
            <a href="stats.html"><ion-icon name="stats-chart-outline"></ion-icon></a>
        </div>
    </nav>

    <main>
        <h2 class="stattitle">Poop statistics</h2>
        <div class="statcontainer">
            <div class="statistic" id="curve_chart" style="width: 95%; height: 400px;"></div>
            <div class="statistic" id="pie_googlechart" style="width: 95%; height: 260px;"></div>
        </div>
    </main>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <script>
        // --- Replace with your Google Sheet ID ---
        const SHEET_ID = "1w-myYITTcVtT4nFD1ZfZY6rWzEBWVSqALz_zI6m6yyw";

        // Load Google Charts
        google.charts.load('current', {packages:['corechart']});
        google.charts.setOnLoadCallback(drawAllCharts);

        function drawAllCharts() {
            drawPieChart();
            drawLineChart();
        }

        // ----- PIE CHART -----
        function drawPieChart() {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=graphs`;
            const query = new google.visualization.Query(url);
            query.setQuery("select D, E"); // A = labels, B = numeric values
            query.send(response => {
                if (response.isError()) {
                    alert('Error: ' + response.getMessage());
                    return;
                }
                const data = response.getDataTable();
                const options = {
                    title: 'Poop Distribution',
                    pieHole: 0.3,
                    width: '100%',
                    height: 250
                };
                const chart = new google.visualization.PieChart(document.getElementById('pie_googlechart'));
                chart.draw(data, options);
            });
        }

        // ----- LINE CHART -----
        function drawLineChart() {
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=Sheet2`;
            const query = new google.visualization.Query(url);
            query.setQuery("select N, O"); // B = X-axis, E = Y-axis
            query.send(response => {
                if (response.isError()) {
                    alert('Error: ' + response.getMessage());
                    return;
                }
                const data = response.getDataTable();
                var options = {
                    title: 'Poop Over Time',
                    curveType: 'function',
                    legend: { position: 'none' },
                    width: "100%",
                    height: "100%",
                    hAxis: {
                        format: 'MM yyyy', // e.g., "Sep 2025"
                        gridlines: { count: 10 }
                    },
                };

                const chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
                chart.draw(data, options);
            });
        }
    </script>
</body>
</html>
